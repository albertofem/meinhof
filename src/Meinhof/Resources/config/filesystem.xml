<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="filesystem.site.class"
            >Meinhof\Model\Site\FilesystemSite</parameter>

        <parameter key="filesystem.templating.loader.class"
            >Meinhof\Templating\Loader\FilesystemLoader</parameter>
        <parameter key="filesystem.templating.post.loader.class"
            >Meinhof\Templating\Loader\FrontMatterLoader</parameter>
        <parameter key="filesystem.templating.markdown.class"
            >Meinhof\Templating\MarkdownEngine</parameter>
        <parameter key="filesystem.templating.twig.loader.class"
            >\Twig_Loader_Filesystem</parameter>
        <parameter key="filesystem.templating.twig.class"
            >Meinhof\Templating\TwigEngine</parameter>
        <parameter key="filesystem.templating.twig.assetic_extension.class"
            >Assetic\Extension\Twig\AsseticExtension</parameter>
        <parameter key="filesystem.matter_loader.yaml.class"
            >Meinhof\Config\Loader\YamlMatterLoader</parameter>
        <parameter key="filesystem.matter_loader.class"
            >Meinhof\Config\Loader\TemplateMatterLoader</parameter>
        <parameter key="filesystem.templating.twig.loader.class"
            >\Twig_Loader_Filesystem</parameter>
        <parameter key="filesystem.site_exporter.class"
            >Meinhof\Exporter\FilesystemSiteExporter</parameter>
        <parameter key="filesystem.action.load_translation_resources.class"
            >Meinhof\Action\LoadFilesystemTranslationResourcesAction</parameter>

        <parameter key="assetic.paths.read_from"
            >%filesystem.paths.public%</parameter>
        <parameter key="assetic.paths.write_to"
            >%filesystem.paths.web%</parameter>
    </parameters>
    <services>
        <service id="site" class="%filesystem.site.class%">
            <argument>%filesystem.paths%</argument>
            <argument>%site.info%</argument>
            <argument>%filesystem.pages%</argument>
            <argument>%filesystem.categories%</argument>
            <call method="setPostTemplatingEngine">
                <argument type="service" id="templating.post"/>
            </call>
            <call method="setPostMatterLoader">
                <argument type="service" id="matter_loader.post"/>
            </call>
        </service>
        <service id="templating.post.content_loader"
            class="%filesystem.templating.loader.class%" public="false">
            <argument>%filesystem.paths.posts%</argument>
        </service>
        <service id="templating.post.loader"
            class="%filesystem.templating.post.loader.class%" public="false">
            <argument type="service" id="templating.post.content_loader"/>
        </service>
        <service id="templating.view.loader"
            class="%filesystem.templating.loader.class%" public="false">
            <argument>%filesystem.paths.views%</argument>
        </service>
        <service id="templating.content.loader"
            class="%filesystem.templating.loader.class%" public="false">
            <argument>%filesystem.paths.content%</argument>
        </service>
        <service id="matter_loader.yaml"
            class="%filesystem.matter_loader.yaml.class%">
        </service>
        <service id="matter_loader.post"
            class="%filesystem.matter_loader.class%">
            <argument type="service" id="templating.name_parser"/>
            <argument type="service" id="templating.post.loader"/>
            <argument type="service" id="matter_loader.yaml"/>
            <argument>%site.post%</argument>
        </service>
        <service id="site_exporter" class="%filesystem.site_exporter.class%">
            <argument type="service" id="templating.view"/>
            <argument type="service" id="url_helper"/>
            <argument>%filesystem.paths.web%</argument>
            <call method="setEventDispatcher">
                <argument type="service" id="event_dispatcher"/>
            </call>
        </service>

        <!-- twig -->
        <service id="twig.templating.content.loader" class="%filesystem.templating.twig.loader.class%" public="false">
            <argument>%filesystem.paths.posts%</argument>
        </service>
        <service id="twig.templating.post.loader" class="%filesystem.templating.twig.loader.class%" public="false">
            <argument>%filesystem.paths.posts%</argument>
        </service>
        <service id="twig.templating.view.loader" class="%filesystem.templating.twig.loader.class%" public="false">
            <argument>%filesystem.paths.views%</argument>
        </service>

        <!-- actions -->
        <service id="filesystem.action.load_translation_resources" class="%filesystem.action.load_translation_resources.class%">
            <argument type="service" id="translator"/>
            <argument>%filesystem.paths.translations%</argument>
            <tag name="event_listener" event="update" method="take" priority="10"/>
        </service>
    </services>
</container>
